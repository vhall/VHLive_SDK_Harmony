import { KeyboardAvoidMode } from '@kit.ArkUI';
import {
  LikeIcon,
  RoomToolsStatusData,
  VHChatDisableAllMsg,
  VHConfigList,
  VHContent,
  VHContext,
  VHIMMessageModel,
  VHIMServer,
  VHMsgData,
  VHQuestionAnswerMsg,
  VHQuestionHistoryInfo,
  VHQuestionHistoryList,
  VHRoomEventType,
  VHSaaSDK,
  VHWebinarData
} from '@vhall/vhall_live';

import { EmitterMsgData, EmitterUtil } from '../../util/EmitterUtil';
import { ToastUtil } from '../../action/ToastUtil';
import { EmojiTool } from './EmojiTool';
import ChatTools from '../../util/ChatTools';

/**
 * é—®ç­”ç•Œé¢
 *
 */
@Component
export struct PrivateChatComponent {
  @Prop functionConfig: VHConfigList | null = null; //åŠŸèƒ½é…ç½®
  @State chatDisable: boolean = false;
  @Prop room_tool: RoomToolsStatusData | null = null;
  @Prop webinars: VHWebinarData | null = null;
  @Prop imBase: VHIMServer;
  @State avatar: string | undefined = "";
  @State inputText: string = "å‚ä¸èŠå¤©";
  @State messageInput: string = '';
  @State senderId: string = '';
  /** èŠå¤©åˆ—è¡¨çš„æ»šåŠ¨æ¡ç»„ä»¶ */
  private scroller: Scroller = new Scroller();
  /** èŠå¤©æ¶ˆæ¯åˆ—è¡¨å¯¹åº”çš„æ•°æ®æºå¯¹è±¡ï¼ˆæœ¬å¯¹è±¡ä¸MessageProvideré…åˆï¼Œç”¨äºå®ç°UIç•Œé¢ä¸æ•°æ®ç»„çš„è§£å¶ï¼‰*/
  @State historyData: VHContent[] = [];
  // ç”¨æ¥é…ç½®CanvasRenderingContext2Då¯¹è±¡çš„å‚æ•°ï¼Œå¼€å¯æŠ—é”¯é½¿
  private settings: RenderingContextSettings = new RenderingContextSettings(true)
  // æ­£ç¡®åˆ›å»ºCanvasRenderingContext2Då¯¹è±¡
  private context: CanvasRenderingContext2D = new CanvasRenderingContext2D(this.settings)
  private animationId: number = 0 // åŠ¨ç”»ID
  // emojiè¡¨æƒ…æ•°ç»„
  private readonly emojis: string[] = [
    'â¤ï¸', 'ğŸ§¡', 'ğŸ’›', 'ğŸ’š', 'ğŸ’™', 'ğŸ’œ',
    'ğŸ¼', 'ğŸ¦', 'ğŸ¯', 'ğŸ¦Š',
    'ğŸ', 'ğŸ€', 'ğŸ‰', 'ğŸŠ', 'âœ¨', 'â­'
  ]
  // çŠ¶æ€ç®¡ç†ï¼šæ§åˆ¶é¢„è§ˆæ˜¾ç¤º/éšè— + å½“å‰é¢„è§ˆçš„å›¾ç‰‡URL
  @State isPreviewShow: boolean = false;
  @State currentPreviewUrl: string = '';
  @State likeIcons: LikeIcon[] = [] // å­˜å‚¨æ‰€æœ‰ç‚¹èµå›¾æ ‡
  @StorageProp('privateChatMsg') privateChatMsg: string = '';
  aboutToAppear() {
    this.avatar = this.webinars?.join_info?.avatar;
    // å¯åŠ¨åŠ¨ç”»å¾ªç¯
    this.startAnimation();
    this.getHistoryData();
    this.subscribePrivateChatMessage();
    this.subscribeChatDisable();

    if (this.webinars?.join_info?.is_gag == 1 || this.room_tool?.all_banned == 1 || this.room_tool?.is_board == 1 ||
      this.room_tool?.is_kicked == 1) {
      this.chatDisable = true;
    }

    if(this.functionConfig?.watch_record_no_chatting == 1 && this.webinars?.webinar?.type == 5){
      this.chatDisable = true;
    }
  }

  /**
   * ç•Œé¢è¢«é”€æ¯æ—¶è¢«è°ƒç”¨ã€‚
   */
  aboutToDisappear() {
    // this.setKeyboardAvoidModeToRESIZE(this.getUIContext(), false);
    // æ¸…é™¤åŠ¨ç”»å¾ªç¯
    clearInterval(this.animationId);
    EmitterUtil.unsubscribe(VHRoomEventType.IM_PRIVATE_TEXT);
  }

  //è®¢é˜…ç¦è¨€äº‹ä»¶
  subscribeChatDisable() {
    EmitterUtil.subscribe(VHRoomEventType.CHAT_DISABLE, (msgData: EmitterMsgData) => {
      this.chatDisable = true;
    });
    EmitterUtil.subscribe(VHRoomEventType.CHAT_PERMIT, (msgData: EmitterMsgData) => {
      this.chatDisable = false;
    });

    EmitterUtil.subscribe(VHRoomEventType.CHAT_DISABLE_ALL, (msgData: EmitterMsgData) => {
      let chatDisableAllMsg: VHChatDisableAllMsg = msgData.data as VHChatDisableAllMsg;
      if (chatDisableAllMsg != null && chatDisableAllMsg.qa_status === 1) {
        this.chatDisable = true;
      }
    });
    EmitterUtil.subscribe(VHRoomEventType.CHAT_PERMIT_ALL, (msgData: EmitterMsgData) => {
      let chatDisableAllMsg: VHChatDisableAllMsg = msgData.data as VHChatDisableAllMsg;
      if (chatDisableAllMsg != null && chatDisableAllMsg.qa_status === 1) {
        this.chatDisable = false;
      }
    });
  }

  getHistoryData(){
    if (this.privateChatMsg.length > 0) {
      let messageModel = JSON.parse(this.privateChatMsg) as VHIMMessageModel;
      if (messageModel.data!) {
        // å®é™…ä¸šåŠ¡ï¼šå°†æ¶ˆæ¯æ·»åŠ åˆ°åˆ—è¡¨ã€æ›´æ–°UIç­‰
        this.handlePrivateChatMessage(messageModel);
        AppStorage.delete('privateChatMsg');
        // å»¶è¿Ÿæ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯ï¼ˆç¡®ä¿UIå·²æ›´æ–°ï¼‰
        setTimeout(() => {
          this.scrollToBottom();
        }, 100);
      }
    }
  }
  // è®¢é˜…Textç±»å‹æ¶ˆæ¯
  subscribePrivateChatMessage() {
    EmitterUtil.subscribe(VHRoomEventType.IM_PRIVATE_TEXT, (msgData: EmitterMsgData) => {
      console.log(`æ”¶åˆ°ç§èŠæ¶ˆæ¯ï¼Œç±»å‹ï¼š${VHRoomEventType.IM_PRIVATE_TEXT}`);
      let messageModel: VHIMMessageModel = msgData as VHIMMessageModel;
      if (messageModel.data!) {
        // å®é™…ä¸šåŠ¡ï¼šå°†æ¶ˆæ¯æ·»åŠ åˆ°åˆ—è¡¨ã€æ›´æ–°UIç­‰
        this.handlePrivateChatMessage(messageModel.data);
        // å»¶è¿Ÿæ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯ï¼ˆç¡®ä¿UIå·²æ›´æ–°ï¼‰
        setTimeout(() => {
          this.scrollToBottom();
        }, 100);
      }
    });
  }

  handlePrivateChatMessage(msg?: VHIMMessageModel) {
    if (!msg) {
      return;
    }
    // æ¥æ”¶æ–‡æœ¬æ¶ˆæ¯
    let senderId =msg.sender_id;
    let imMsg: VHContent = msg as VHContent;
    let msgData: VHMsgData = msg.data as VHMsgData;
    imMsg.nickname = msg.nick_name;
    imMsg.date_time = this.formatTime(msg.date_time!);
    imMsg.data = msgData;
    if (senderId === this.webinars!.join_info!.user_id!.toString()) {
      this.senderId = msgData.target_id;
    }else{
      this.senderId = senderId!.toString();
    }
    let context = JSON.parse(msg.context as string) as VHContext;
    imMsg.role_name = context.role_name === '1' ? 'ä¸»æŒäºº' : '';
    this.historyData.push(imMsg);
  }

  sendQuestion() {
    this.imBase.sendMessageToTarget(this.messageInput, this.senderId, {
      onSuccess: () => {
        console.log("æ¶ˆæ¯å‘é€æˆåŠŸ");
        this.messageInput = '';
        // æ”¶èµ·è½¯é”®ç›˜
        this.hideSoftInputMethod(this.getUIContext());
        // 5. å»¶è¿Ÿæ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯ï¼ˆç¡®ä¿UIå·²æ›´æ–°ï¼‰
        setTimeout(() => {
          this.scrollToBottom();
        }, 100);
      },
      onFailure(errorCode: number, errorMsg: string) {
        // å¼¹å‡ºæ¶ˆæ¯ä¿¡æ¯
        ToastUtil.showToast("å‘é€æ¶ˆæ¯å¤±è´¥");
      }
    });
  }



  formatTime(dateTime: string): string {
    return dateTime.substring(dateTime.lastIndexOf(" "));
  }

  /**
   * æ»šåŠ¨æ¶ˆæ¯åˆ—è¡¨åˆ°æœ€åº•éƒ¨ï¼Œä»¥å¤‡æ˜¾ç¤ºæœ€æ–°æ¶ˆæ¯ã€‚
   */
  scrollToBottom() {
    this.scroller.scrollEdge(Edge.Bottom);
  }

  setKeyboardAvoidModeToRESIZE(context: UIContext, toRESIZE: boolean) {
    context.setKeyboardAvoidMode(toRESIZE ? KeyboardAvoidMode.RESIZE : KeyboardAvoidMode.OFFSET);
  }

  /**
   * æ”¶åˆ°é”®ç›˜
   * @param context
   */
  hideSoftInputMethod(context: UIContext) {
    context.getFocusController().clearFocus();
  }

  // åˆ›å»ºä¸€ä¸ªå›¾æ ‡å¯¹è±¡
  createIcon(x: number, y: number, radius: number, emoji: string): LikeIcon {
    // ä¸ºå›¾æ ‡ç”Ÿæˆéšæœºå±æ€§
    const initialScale = 0.4 + Math.random() * 0.2 // åˆå§‹ç¼©æ”¾æ¯”ä¾‹0.4-0.6
    const maxScale = 1.0 + Math.random() * 0.3 // æœ€å¤§ç¼©æ”¾æ¯”ä¾‹1.0-1.3
    // å‡å°æ‘†åŠ¨å¹…åº¦ï¼Œæ”¹ä¸ºæœ€å¤§8-15åƒç´ 
    const maxOffset = 8 + Math.random() * 7 // æœ€å¤§æ‘†åŠ¨å¹…åº¦8-15åƒç´ 
    // éšæœºå†³å®šåˆå§‹æ‘†åŠ¨æ–¹å‘
    const direction = Math.random() > 0.5 ? 1 : -1

    return {
      x: x,
      y: y,
      initialX: x, // è®°å½•åˆå§‹Xåæ ‡
      initialY: y, // è®°å½•åˆå§‹Yåæ ‡
      radius: radius,
      emoji: emoji,
      fontSize: Math.floor(radius * 1.2),
      opacity: 1.0,
      createTime: Date.now(),
      lifespan: 1500, // å»¶é•¿ç”Ÿå‘½å‘¨æœŸè‡³1.5ç§’
      scale: initialScale, // å½“å‰ç¼©æ”¾æ¯”ä¾‹
      initialScale: initialScale, // åˆå§‹ç¼©æ”¾æ¯”ä¾‹
      maxScale: maxScale, // æœ€å¤§ç¼©æ”¾æ¯”ä¾‹
      maxOffset: maxOffset, // æœ€å¤§æ‘†åŠ¨å¹…åº¦
      direction: direction // åˆå§‹æ‘†åŠ¨æ–¹å‘
    }
  }

  // è·å–éšæœºemoji
  getRandomEmoji(): string {
    return this.emojis[Math.floor(Math.random() * this.emojis.length)]
  }

  // æ·»åŠ æ–°çš„ç‚¹èµå›¾æ ‡
  addLikeIcon(baseX: number, baseY: number) {
    const radius = 80 + Math.random() * 20
    const emoji = this.getRandomEmoji()
    // æ·»åŠ éšæœºä½ç½®åç§»ï¼ˆÂ±15pxèŒƒå›´å†…ï¼‰
    const offsetX = Math.random() * 30 - 15
    const offsetY = Math.random() * 30 - 15
    this.likeIcons.push(this.createIcon(baseX + offsetX, baseY + offsetY, radius, emoji))
  }

  // å¼€å§‹åŠ¨ç”»å¾ªç¯
  startAnimation() {
    this.animationId = setInterval(() => {
      this.updateIcons()
      this.drawAllIcons()
    }, 16) // çº¦60fpsçš„åˆ·æ–°ç‡
  }

  // æ›´æ–°æ‰€æœ‰å›¾æ ‡çŠ¶æ€
  updateIcons() {
    const currentTime = Date.now()
    const newIcons: LikeIcon[] = []

    for (let icon of this.likeIcons) {
      // è®¡ç®—å›¾æ ‡å·²å­˜åœ¨çš„æ—¶é—´
      const existTime = currentTime - icon.createTime

      if (existTime < icon.lifespan) {
        // è®¡ç®—å­˜åœ¨æ—¶é—´æ¯”ä¾‹
        const progress = existTime / icon.lifespan

        // 1. æ›´æ–°Yåæ ‡ - å‘ä¸Šç§»åŠ¨ï¼Œé€Ÿåº¦å˜åŒ–æ›´æ˜æ˜¾
        const verticalDistance = 200 * Math.pow(progress, 0.5) // å‡ç¼“ä¸Šå‡é€Ÿåº¦ // ä½¿ç”¨å¹‚å‡½æ•°è®©ä¸Šå‡æ›´å¿«
        icon.y = icon.initialY - verticalDistance

        // 2. æ›´æ–°Xåæ ‡ - å¿«é€Ÿçš„å·¦å³æ‘†åŠ¨
        // æ¯0.25ç§’ä¸€ä¸ªé˜¶æ®µï¼Œæ€»å…±1ç§’4ä¸ªé˜¶æ®µ
        let horizontalOffset = 0;

        if (progress < 0.25) {
          // 0-0.25s: æ— åç§»ï¼Œä¸“æ³¨äºæ”¾å¤§
          horizontalOffset = 0;
        } else if (progress < 0.5) {
          // 0.25-0.5s: å‘å·¦åç§»
          const phaseProgress = (progress - 0.25) / 0.25;
          horizontalOffset = -icon.maxOffset * phaseProgress * icon.direction;
        } else if (progress < 0.75) {
          // 0.5-0.75s: ä»å‘å·¦åç§»å˜ä¸ºå‘å³åç§»
          const phaseProgress = (progress - 0.5) / 0.25;
          horizontalOffset = icon.maxOffset * (2 * phaseProgress - 1) * icon.direction;
        } else {
          // 0.75-1s: ä»å‘å³åç§»å›åˆ°å‘å·¦åç§»
          const phaseProgress = (progress - 0.75) / 0.25;
          horizontalOffset = icon.maxOffset * (1 - 2 * phaseProgress) * icon.direction;
        }

        icon.x = icon.initialX + horizontalOffset;

        // 3. æ›´æ–°ç¼©æ”¾æ¯”ä¾‹ - å¿«é€Ÿæ”¾å¤§
        // åœ¨ç”Ÿå‘½å‘¨æœŸçš„å‰20%é˜¶æ®µ(0.2s)ï¼Œç¼©æ”¾ä»initialScaleå¢å¤§åˆ°maxScale
        if (progress < 0.2) {
          // å¹³æ»‘æ’å€¼ä»initialScaleåˆ°maxScale
          icon.scale = icon.initialScale + (icon.maxScale - icon.initialScale) * (progress / 0.2)
        } else {
          // ä¿æŒmaxScale
          icon.scale = icon.maxScale
        }

        // 4. æ›´æ–°é€æ˜åº¦ - å‰60%ä¿æŒä¸å˜ï¼Œå40%é€æ¸æ¶ˆå¤±
        if (progress > 0.6) {
          // åœ¨æœ€å40%çš„ç”Ÿå‘½å‘¨æœŸå†…æ”¹å˜é€æ˜åº¦ï¼Œä½¿æ¶ˆå¤±æ›´å¿«
          icon.opacity = 1.0 - ((progress - 0.6) / 0.4)
        } else {
          icon.opacity = 1.0
        }

        // ä¿ç•™æœªå®Œæˆç”Ÿå‘½å‘¨æœŸçš„å›¾æ ‡
        newIcons.push(icon)
      }
    }

    // æ›´æ–°å›¾æ ‡æ•°ç»„
    this.likeIcons = newIcons
  }

  // ç»˜åˆ¶æ‰€æœ‰å›¾æ ‡
  drawAllIcons() {
    // æ¸…é™¤ç”»å¸ƒ
    this.context.clearRect(0, 0, this.context.width, this.context.height)

    // ç»˜åˆ¶æ‰€æœ‰å›¾æ ‡
    for (let icon of this.likeIcons) {
      this.context.save()

      // è®¾ç½®é€æ˜åº¦
      this.context.globalAlpha = icon.opacity

      // è®¾ç½®ç¼©æ”¾ï¼ˆä»ä¸­å¿ƒç‚¹ç¼©æ”¾ï¼‰
      this.context.translate(icon.x, icon.y)
      this.context.scale(icon.scale, icon.scale)
      this.context.translate(-icon.x, -icon.y)

      // ç»˜åˆ¶emoji
      this.context.font = `${icon.fontSize}px`
      this.context.textAlign = 'center'
      this.context.textBaseline = 'middle'
      this.context.fillText(icon.emoji, icon.x, icon.y)

      this.context.restore()
    }
  }

  // ç‚¹å‡»åˆ—è¡¨å›¾ç‰‡ï¼šæ‰“å¼€é¢„è§ˆ
  openImagePreview(url: string) {
    this.currentPreviewUrl = url;
    this.isPreviewShow = true;
  }

  // ç‚¹å‡»èŠå¤©åˆ—è¡¨ï¼šå…³é—­é¢„è§ˆ
  closeImagePreview() {
    this.isPreviewShow = false;
  }

  build() {
    Column() {
      // èŠå¤©ç•Œé¢å†…å®¹åŒº
      Column() {
        List({ space: 4, scroller: this.scroller }) {
          ForEach(this.historyData, (item: VHContent, index) => {
            ListItem() {
              Column({ space: 8 }) {
                Row() {
                  Image(item.avatar === '' ? $r("app.media.icon_visitorvatar") : item.avatar)
                    .width(30)
                    .height(30)
                    .borderRadius(20)
                  Column() {
                    Row() {
                      Text(ChatTools.getLimitString(item.nickname!, 8))
                        .fontColor(Color.Gray).fontSize(12).padding({ right: 10 })
                      Text(item.role_name!)
                        .fontColor(Color.Red)
                        .fontSize(12)
                        .borderRadius(8)
                        .backgroundColor(item.role_name.length > 0 ? '#FFE6F2' : "#FAFAFA")
                        .padding({
                          top: 2,
                          left: 4,
                          right: 4,
                          bottom: 2
                        })
                      if (item.date_time!.length > 0) {
                        Text(this.formatTime(item.date_time!))
                          .fontColor(Color.Gray)
                          .fontSize(12)
                          .layoutWeight(1)
                          .padding({ right: 10 })
                          .textAlign(TextAlign.End)
                      }
                    }

                    Column() {
                      Text(EmojiTool.convertEmojiTags(item.data?.text_content!))
                        .fontSize(12)
                        .textAlign(TextAlign.Start)
                        .padding({ left: 5 })
                        .backgroundColor(Color.White)
                        .padding({
                          left: 4,
                          right: 4,
                          top: 2,
                          bottom: 2
                        })
                    }
                    .width('98%')
                    .margin({ right: 10 })
                    .justifyContent(FlexAlign.Start)
                    .alignItems(HorizontalAlign.Start)
                  }
                  .width('98%')
                  .padding(8)
                  .margin({ top: 2 })
                  .borderRadius(8)
                  .alignItems(HorizontalAlign.Start)
                  .justifyContent(FlexAlign.Start)
                }
                .width('98%')
                .padding({ right: 10 })
                .justifyContent(FlexAlign.Start)
                .alignItems(VerticalAlign.Top)

              }.width('100%')
            }
          }
          )
        }
        .width('100%')
        .height('80%')
        // ç›‘å¬ç»„ä»¶è§¦å±äº‹ä»¶ï¼Œç¡®ä¿è§¦ç¢°èŠå¤©åˆ—è¡¨æ—¶ï¼Œèƒ½è‡ªåŠ¨æ”¶èµ·è¾“å…¥æ³•è½¯é”®ç›˜ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
        .onTouch((event: TouchEvent) => {
          // æ”¶èµ·è½¯é”®ç›˜
          this.hideSoftInputMethod(this.getUIContext());
          // ç‚¹å‡»åˆ—è¡¨å…³é—­é¢„è§ˆ
          this.closeImagePreview();
        })
        // ç›‘å¬ç»„ä»¶å¤§å°å˜åŒ–äº‹ä»¶ï¼ˆç”¨äºå®ç°å½“è½¯é”®ç›˜æ˜¾ç¤ºæ—¶ï¼Œåˆ—è¡¨é«˜åº¦è¢«å‹ç¼©åï¼Œæ¶ˆæ¯ä¸èƒ½è‡ªåŠ¨æ˜¾ç¤ºæœ€åä¸€æ¡çš„é—®é¢˜ï¼‰
        .onSizeChange((oldValue: SizeOptions, newValue: SizeOptions) => {
          let oldHeight = oldValue.height, newHeight = newValue.height;
          oldHeight = (oldHeight === undefined ? 0 : oldHeight);
          newHeight = (newHeight === undefined ? 0 : newHeight);
          // åˆ—è¡¨é«˜åº¦å˜å°ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯è½¯é”®ç›˜æ˜¾ç¤ºäº†
          let toBeSmall = (newHeight > 0 && newHeight < oldHeight);
          if (toBeSmall) {
            // æ¶ˆæ¯åˆ—è¡¨æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œç¡®ä¿æœ€æ–°ä¸€æ¡æ¶ˆæ¯è¢«æ˜¾ç¤º
            this.scrollToBottom();
          }
        })
        .scrollBar(BarState.Off)
        .edgeEffect(EdgeEffect.Spring)
        .width("100%")
        .height('100%')
        .layoutWeight(1)
        .listDirection(Axis.Vertical)
        .zIndex(100) // ä¿æŒæœ€é«˜å±‚çº§

        Canvas(this.context)
          .width('100%')
          .height('80%')  // è¿›ä¸€æ­¥å‡å°‘é«˜åº¦
          .position({ x: 0, y: 0 })
          // .position({ type: 'absolute' })
          .zIndex(0)
          .backgroundColor(Color.Transparent)
          .onReady(() => {
            console.info(`Canvas size: ${this.context.width} x ${this.context.height}`)
          })

        // åº•éƒ¨æ¶ˆæ¯è¾“å…¥åŒº
        Row() {
          Image(this.avatar)
            .width(30)
            .height(30)
            .borderRadius(20)

          TextInput({
            placeholder: this.chatDisable ? "æ‚¨å·²è¢«ç¦è¨€" : "å¿«æ¥æé—®å§", text: $$this.messageInput
          })
            .width('70%')
            .height(34)
            .backgroundColor('#EEEEEE')
            .fontSize(15)
            .layoutWeight(1)
            .borderRadius(8)
            .margin({ left: 5, right: 5 })
            .placeholderFont({ size: 14 })
            .placeholderColor('#a1a7af')
            .enabled(!this.chatDisable)
            .onChange((msg: string) => {
              this.messageInput = msg
            })

          Button("æäº¤", { type: ButtonType.Normal, stateEffect: true })
            .width(44)
            .height(34)
            .borderRadius(8)
            .padding(0)
            .fontSize(14)
            .backgroundColor('#00de7a')
            .fontWeight(500)
            .enabled(!this.chatDisable)
            .onClick(() => {
              this.sendQuestion();
            });
        }
        .height(54)
        .width('100%')
        .backgroundColor("#ffffff")
        .padding({ left: 10, right: 10 })
        .alignItems(VerticalAlign.Center)
        .justifyContent(FlexAlign.Start)
      }
      .backgroundColor('#EEEEEE')
      .layoutWeight(1)
    }
    .width('100%')
    .height('100%')
    .backgroundColor(Color.White)
    // é€‚é…æµæµ·å±ï¼ˆé¡¶éƒ¨çŠ¶æ€æ é€æ˜å¹¶ç©¿è¿‡ï¼Œå¹¶é€è¿‡åº•éƒ¨ä¸Šåˆ’æ“ä½œåŒºï¼‰
    .expandSafeArea([SafeAreaType.SYSTEM], [SafeAreaEdge.TOP, SafeAreaEdge.BOTTOM])
  }
}